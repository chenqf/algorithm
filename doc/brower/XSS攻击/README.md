---
ct: 2019/09/18
---

# XSS攻击

跨站点脚本（Cross-site scripting，XSS）是一种允许攻击者在另一个用户的浏览器中执行恶意脚本的脚本注入式攻击。

## 如何注入恶意代码

攻击者可以以字符串的形式向页面插入一段受害者浏览器能够执行的代码。

下面的例子是一个简单的服务端脚本，作用是展现网站上最新的评论:

```javascript
print "<html>"
print "Latest comment:"
print database.latestComment
print "</html>"
```

这段脚本假设评论只由文本组成。但是因为用户的输入直接被包含进页面中，所以攻击者可能提交这样的评论:`<script>...</script>`。任何访问这个页面的用户都会收到下面这样的返回：

```html
<html>
Latest comment:
<script>...</script>
</html>
```

## 恶意脚本的攻击性

+ Javascript有权访问一些用户的敏感信息，比如cookie
+ Javascript能够通过XMLHttpRequest或者其他一些机制发送带有任何内容的HTTP请求到任何地址。
+ Javascript能够通过DOM操作方法对当前页面的HTML做任意修改。

## 攻击后果

+ cookie窃取：通过`document.cookie`访问受害者与网站关联的cookie，然后传送到攻击者自己的服务器，接着从这些cookie中提取敏感信息，如Session ID。
+ 记录用户行为：使用 `addEventListener`方法注册用于监听键盘事件的回调函数，获取密码或卡号。
+ 钓鱼网站：通过修改DOM，插入假的登录框或者修改跳转链接指向自己的服务器。

## 攻击类型

+ 持续型XSS攻击：恶意文本来源于网站的数据库
+ 反射型XSS攻击：恶意文本来源于受害者的请求
+ 基于DOM的XSS攻击：利用客户端而不是服务端代码漏洞发动攻击

### 持续型XSS攻击

1. 攻击者利用提交网站表单将一段恶意文本插入网站的数据库中
2. 受害者向网站请求页面
3. 网站从数据库中取出恶意文本把它包含进返回给受害者的页面中
4. 受害者的浏览器执行返回页面中的恶意脚本，把自己的cookie发送给攻击者的服务器。

### 反射型XSS攻击

1. 攻击者构造了一个包含恶意文本的URL发送给受害者
2. 受害者被攻击者欺骗，通过访问这个URL向网站发出请求
3. 网站给受害者的返回中包含了来自URL的的恶意文本
4. 受害者的浏览器执行了来自返回中的恶意脚本，把受害者的cookie发送给攻击者的服务器

### 基于DOM的XSS攻击

1. 攻击者构造一个包含恶意文本的URL发送受害者
2. 受害者被攻击者欺骗，通过访问这个URL向网站发出请求
3. 网站收到请求，但是恶意文本并没有包含在给受害者的返回页面中
4. 受害者的浏览器执行来自网站返回页面里的合法脚本，导致恶意脚本被插入进页面中
5. 受害者的浏览器执行插入进页面的恶意脚本，把自己的cookie发送到攻击者的服务器