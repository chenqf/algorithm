---
ct: 2019/07/29
---

# 正则相关

## 历史局限

ECMAScript 3 规定，同一段代码表示的正则对象，每次返回都是相同的对象

ECMAScript 5 规定，代码表示的正则对象，每次都返回新对象

Safari 5 及以前版本、Chrome 7 及以前版本对正则执行 typeof 存在兼容问题，返回 function

## 选择

| 用于分隔供选择的字符，选择项的匹配顺序是从左到右，直到发现匹配项，所以 /a|ab/ 匹配 ab 时，只能匹配一个字符

```javascript
/(a|ab)/.test('ab')
console.log(RegExp.$1); // a
```

## 引用

同一正则表达式后部引用前面的子表达式 "\\" 加 数字

引用指的是对匹配的文本的引用

```javascript
/("|')[^\1]*\1+/.test(JSON.stringify('444')) 

// true
```

## 分组

在括号前使用 ?: 实现非捕获性分组

```javascript
/(?:a|ab)c/.test('abc')
console.log(RegExp.$1); // ''
```

## 静态属性

+ RegExp.lastMatch
    + 上次匹配到的字符串 
+ RegExp.leftContext
    + 匹配到的字符串之前的字符串
+ RegExp.rightContext
    + 匹配到的字符串之后的字符串


```javascript
let rg = /\d/g
rg.test('a1b')
console.log(RegExp.lastMatch); // 1
```

```javascript
let rg = /\d/g
'a1b2c3'.match(rg)
console.log(RegExp.lastMatch); // 3
```

```javascript
/\d+/.test('abc123def')
console.log(RegExp.leftContext); // abc
console.log(RegExp.rightContext); // def
```


## 正则属性

+ source  只读字符串，存储正则的文本
+ global  只读属性，是否全局匹配
+ ignoreCase 只读属性，是否忽略大小写
+ multiline 只读属性，是否带有修饰符m，是否多行匹配
+ lastIndex 可读可写的属性，字符串中的检索位置，test/exec 中会用到

## 方法

### test

+ 非全局匹配时
    + 不会修改 lastIndex 
+ 全局匹配时
    + 匹配成功后
        + 会修改 lastIndex 为匹配到的字符的下一位
        + 下次调用从字符串的 lastIndex 位置开始匹配
    + 匹配失败后
        + 将lastIndex 修改为0

```javascript
let rg = /\d/g;

console.log(rg.lastIndex,rg.test('123'),rg.lastIndex);
// 0 true 1

console.log(rg.lastIndex,rg.test('abc'),rg.lastIndex);
// 1 false 0
```

### exec

+ 非全局匹配
    + 不会修改 lastIndex 
+ 全局匹配
    + 匹配成功后, lastIndex 为匹配字符的下一位
    + 匹配失败后, lastIndex 重置为 0

每次调用都会返回一个匹配结果,若为匹配到,返回 null

匹配到,返回一个数组,第一个参数为,匹配的字符,余下参数为分组内容

结果数组包括如下属性: index(匹配到的位置),input(原字符串)

```javascript
let rg = /\d/g;

let res = rg.exec('123abc456')

console.log(res); // [ '1', index: 0, input: '123abc456', groups: undefined ]
```

### match

字符串中的方法,接收一个正则对象,不会读取和修改 lastIndex

+ 非全局匹配
    + 与 exec 方法返回结构一致
+ 全局匹配
    + 返回一个数组
    + 其中包含所有匹配的字符结构 
+ 没有匹配上
    + 返回 null 

```javascript
'123abc456'.match(/(\d)+/g); 
//[ '123', '456' ]
'123abc456'.match(/(\d)+/);
//["123", "3", index: 0, input: "123abc456", groups: undefined]
```

### search

字符串中的方法,接收一个正则对象,不会读取和修改 lastIndex

返回字符串中,第一个匹配项的索引

如果匹配不到,返回 -1

始终从开头像后查找

```javascript
'123'.search(/2/) // 1
'123'.search(/4/) // -1
```

### replace

字符串中的方法,接收两个参数

+ 第一个参数
    + 普通字符串
        + 字符串不会转化为正则对象
        + 无法做到全局替换
    + 正则对象
        + 使用 g 进行全局替换
+ 第二个参数
    + 字符串
        + 可使用特殊字符序列
            + $$ 指代 $
            + $& 指代 RegExp.lastMatch
            + $' 指代 RegExp.leftContext
            + $` 指代 RegExp.rightContext
            + $n 指代正则所匹配的分组内容
    + 函数
        + 第一个参数:
            + 匹配到的子字符串
        + 中间参数:
            + 捕获分组的内容
        + 倒数第二个参数:
            + 匹配的字符串的索引
        + 最后一个参数:
            + 原始字符串
```javascript
'abc123def'.replace(/([a-z]+)/g,function(){
    console.log(arguments)
})

// [Arguments] { '0': 'abc', '1': 'abc', '2': 0, '3': 'abc123def' }
// [Arguments] { '0': 'def', '1': 'def', '2': 6, '3': 'abc123def' }
```